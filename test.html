<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập Facebook - JS Thuần</title>
    <style>
        /* CSS đơn giản cho nút đăng nhập */
        #loginBtn {
            background-color: #1877F2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        #loginBtn:hover {
            background-color: #165eab;
        }

        .hidden {
            display: none;
        }

        .profile-info {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <h2>Demo Đăng nhập Facebook</h2>

    <button id="loginBtn" onclick="loginWithFacebook()">Đăng nhập bằng Facebook</button>

    <div id="status" class="hidden">
        <h3>Xin chào, <span id="userName"></span>!</h3>
        <p>Email: <span id="userEmail"></span></p>
        <button onclick="logoutFacebook()">Đăng xuất</button>
    </div>

    <script>
        // 1. Khởi tạo Facebook SDK
        window.fbAsyncInit = function () {
            FB.init({
                appId: '1420411473420001', // THAY THẾ ID CỦA BẠN VÀO ĐÂY
                cookie: true,  // Cho phép server truy cập session qua cookie
                xfbml: true,  // Parse các plugin xã hội trên trang
                version: 'v18.0' // Phiên bản Graph API
            });

            // Kiểm tra trạng thái đăng nhập ngay khi tải trang
            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
            });
        };

        // 2. Tải SDK bất đồng bộ (Code chuẩn của Facebook)
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/vi_VN/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        // 3. Hàm xử lý trạng thái
        function statusChangeCallback(response) {
            if (response.status === 'connected') {
                // Người dùng đã đăng nhập và kết nối với app
                console.log('Đã kết nối!');
                fetchUserData(); // Lấy thông tin
            } else {
                // Chưa đăng nhập
                console.log('Chưa đăng nhập.');
                document.getElementById('status').classList.add('hidden');
                document.getElementById('loginBtn').classList.remove('hidden');
            }
        }

        // 4. Hàm kích hoạt khi bấm nút Đăng nhập
        function loginWithFacebook() {
            FB.login(function (response) {
                if (response.authResponse) {
                    statusChangeCallback(response);
                } else {
                    console.log('Người dùng hủy đăng nhập hoặc không cho phép.');
                }
            }, { scope: 'public_profile,email' }); // Yêu cầu quyền truy cập email
        }

        // 5. Hàm lấy thông tin người dùng qua Graph API
        function fetchUserData() {
            console.log('Đang lấy thông tin...');
            FB.api('/me', { fields: 'name, email' }, function (response) {
                console.log('Kết quả:', response);

                // Hiển thị ra giao diện
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('status').classList.remove('hidden');
                document.getElementById('userName').innerText = response.name;
                document.getElementById('userEmail').innerText = response.email || 'Không có email';
            });
        }

        // 6. Hàm đăng xuất
        function logoutFacebook() {
            FB.logout(function (response) {
                statusChangeCallback(response);
                location.reload(); // Tải lại trang cho sạch
            });
        }
    </script>
</body>

</html>